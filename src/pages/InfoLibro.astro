---
import Layout from '../layouts/Layout.astro';
import InformacionLibro from '../components/InformacionLibro.astro';
import Sinopsis from '../components/Sinopsis.astro';

---

<Layout title="Información del libro">
    <InformacionLibro/>
    <Sinopsis/>
    
</Layout>


  <script>
    const params = new URLSearchParams(location.search);
    const idLibro = params.get('idLibro');
    try {
        const response = await fetch(`/api/${idLibro}`);
        if (response.ok) {
          const data = await response.json();
          mostrarLibroEnPantalla(data);
        } else {
          console.error('Error en la solicitud:', response.statusText);
        }
    } catch (error) {
      console.error('Error en la solicitud:', error);
    }

    function mostrarLibroEnPantalla(data: any) {
      const seccionInfoLibro = document.getElementById('seccionInfoLibro');
      const seccionSinopsis = document.getElementById('seccionSinopsis');
      var nombreLibro = document.getElementById('nombreLibro');
      var nombreAutor = document.getElementById('nombreAutor');
      var imagenLibro = document.getElementById('imagenLibro');
      var sinopsisLibro = document.getElementById('sinopsisLibro');
      var numPaginasLibro = document.getElementById('numPaginasLibro');
      var fechaPubliLibro = document.getElementById('fechaPubliLibro');
      var generoLibro = document.getElementById('generoLibro');

      if (seccionInfoLibro && seccionSinopsis) {
        data.forEach((libro: any) => {
          if(imagenLibro && nombreLibro && nombreAutor && sinopsisLibro && numPaginasLibro && fechaPubliLibro && generoLibro){
            nombreLibro.innerHTML = libro.tituloLibro;
            nombreAutor.innerHTML = libro.nombreAutor;
            imagenLibro.setAttribute('src', libro.portadaLibro);
            seccionInfoLibro.style.backgroundImage = "url('" + libro.fondoLibro + "')";
            sinopsisLibro.innerHTML = libro.sinopsisLibro;
            numPaginasLibro.innerHTML = libro.nPaginasLibro;
            generoLibro.innerHTML = libro.categoriaLibro;

            var fechaPubLibro = formatearFecha(libro.fechaPubLibro);
            fechaPubliLibro.innerHTML = fechaPubLibro;
          }
        });
      }
    }

    function formatearFecha(fechaPubLibro: Date){
      var fecha = new Date(fechaPubLibro);
      var dia = fecha.getDate();
      var mes = fecha.getMonth() + 1;
      var año = fecha.getFullYear();
      var fechaFormateada = (dia < 10 ? '0' : '') + dia + '-' + (mes < 10 ? '0' : '') + mes + '-' + año;
      return fechaFormateada;
    }
  </script>