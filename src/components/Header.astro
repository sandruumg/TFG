---
import { db, User, Session, Libros } from 'astro:db';
import { eq } from 'astro:db';
interface Props {
	user?: string;
}

if(Astro.locals.user){
  const user = Astro.locals.user;
  const usuarios = await db.select().from(User).where(eq(User.id, user.id));
  const [infoUser] = usuarios;
  const alias = infoUser.aliasUsuario;
  Astro.props.user = alias;
}
const { user } = Astro.props;

---

<header class="">
    <nav class="border-gray-200 px-4 lg:px-6 py-6 bg-gray-800">
        <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl">
            <a href="/" class="flex items-center">
                <img src="/imagenes/logo.png" class="h-20" alt="Flowbite Logo" />
            </a>
            <div class="flex items-center lg:order-2">
              <a href="#" class="text-white hover:bg-gray-500 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2">Lista de seguimiento</a>
              {user !== undefined && <form  method="post" action="/api/signout"><button class="text-white mr-6">Sign out</button></form>}
              {user !== undefined && <a href="perfil" class="text-white">{user}</a>}
              {user === undefined &&  <button id="btn-login" class="btn" onclick="my_modal_3.showModal()">Log in</button>}
             
              <dialog id="my_modal_3" class="modal text-xl">
                <div class="modal-box flex flex-col items-center gap-2 py-24">
                    <img src="/imagenes/logo-2.png" class="h-30" alt="Flowbite Logo" />
                  <form method="dialog">
                    <button id="close-modal" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
                  </form>
                  <div class="flex flex-row justify-around items-center w-2/3 my-5 text-gray-900">
                    <button id="inicioBtn" class="font-bold text-2xl my-5 text-accent">Inicia Sesión</button>
                    <button id="registroBtn" class="font-bold text-2xl my-5">Registrate</button>
                  </div>
                  <div class="flex justify-around w-[90%]">
                    <div id="formulario-login" class="w-[90%]">
                      <form id="login-form" class="flex flex-col justify-center	content-center gap-5">
                        <input type="text" id="aliasUsuario" name="aliasUsuario" placeholder="Nombre de usuario" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <input type="password" id="password" name="password" placeholder="Contraseña" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <button type="submit" class="bg-accent text-white mt-10 p-3 rounded-lg">Iniciar sesion</button>
                      </form>
                    </div>
                    <div id="formulario-register" class="w-[90%] hidden">
                      <form id="register-form" method="post" action="/api/signup" class="flex flex-col justify-center	content-center gap-5">
                        <input type="text" id="aliasUsuarioR" name="aliasUsuario" placeholder="Nombre de usuario" class="border-b-2 border-gray-200 hover:border-accent caret-transparent" required>
                        <input type="text" id="nombreUsuarioR" name="nombreUsuario" placeholder="Nombre" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <input type="text" id="apellidoUsuarioR" name="apellidoUsuario" placeholder="Apellidos" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <input type="email" id="correoUsuarioR" name="correoUsuario" placeholder="Correo electrónico" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <input type="password" id="passwordR" name="password" placeholder="Contraseña" class="border-b-2 border-gray-200 hover:border-accent" required>
                        <button type="submit" class="bg-accent text-white mt-10 p-3 rounded-lg">Registrarse</button>
                      </form>
                    </div>
                  </div>
                </div>
              </dialog>

             
              <button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false">                    
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                  <svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
              </button>
          </div>
            <div class="w-full md:w-1/2">
                <form method="POST" id="formularioBusqueda" class="flex items-center">
                  <div class="relative w-full">
                      <input type="search" id="buscador" class="block p-2.5 pl-8 w-full z-20 fuente-2 text-sm text-gray-900 bg-custom-grey rounded-3xl border-s-gray-50 border-s-2 border border-gray-300 focus:ring-gray-500 focus:border-gray-500 dark:bg-gray-700 dark:border-s-gray-700  dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-gray-500" placeholder="Buscar..." required />
                      <button type="submit" class="absolute pr-6 pl-4 top-0 end-0 h-full p-2.5 text-sm font-medium text-white bg-custom-grey rounded-e-3xl border border-slate-300 hover:bg-gray-300 focus:ring-4 focus:outline-none focus:ring-custom-green dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                          <svg class="w-4 h-4 text-secondary" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                          </svg>
                          <span class="sr-only">Search</span>
                      </button>
                    </div>
                  </form>
              </div>
        </div>
    </nav>
</header>
<script src="/src/scripts/buscador.js"></script>
<script src="/src/scripts/sesion.js"></script>
